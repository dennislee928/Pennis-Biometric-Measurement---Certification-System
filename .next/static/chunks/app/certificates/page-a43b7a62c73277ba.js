(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[266],{31566:function(t,e,n){Promise.resolve().then(n.bind(n,21677))},21677:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return l}});var s=n(57437),a=n(2265),r=n(87138),c=n(48652),i=n(96264),o=n(59941);function l(){let{session:t,accessToken:e}=(0,c.a)(),[n,l]=(0,a.useState)([]),[u,d]=(0,a.useState)(!0),[h,f]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!e){d(!1);return}(0,i.EN)(e).then(l).catch(t=>f(t instanceof Error?t.message:"載入失敗")).finally(()=>d(!1))},[e]);let m=async t=>{if(e)try{let n=await (0,i.mv)(e,t);(0,o.cP)(n)}catch(t){f(t instanceof Error?t.message:"下載失敗")}};return(0,s.jsx)("main",{className:"min-h-screen bg-slate-50 px-4 py-12",children:(0,s.jsxs)("div",{className:"mx-auto max-w-2xl",children:[(0,s.jsx)("h1",{className:"mb-2 text-xl font-bold text-slate-900",children:"我的證書"}),(0,s.jsx)("p",{className:"mb-6 text-sm text-slate-600",children:"您已簽發的證書列表（多裝置同步）。"}),(0,s.jsx)(r.default,{href:"/",className:"mb-4 inline-block text-sm text-slate-600 hover:text-slate-900",children:"← 返回首頁"}),!t&&(0,s.jsxs)("div",{className:"rounded-lg bg-amber-50 p-4 text-amber-800",children:["請先 ",(0,s.jsx)(r.default,{href:"/login",className:"underline",children:"登入"})," 以查看證書。"]}),t&&(0,s.jsxs)(s.Fragment,{children:[u&&(0,s.jsx)("p",{className:"text-slate-500",children:"載入中…"}),h&&(0,s.jsx)("p",{className:"text-red-600",children:h}),!u&&!h&&0===n.length&&(0,s.jsx)("p",{className:"text-slate-500",children:"尚無證書。"}),!u&&n.length>0&&(0,s.jsx)("ul",{className:"space-y-3",children:n.map(t=>(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white p-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:t.inquiryId}),(0,s.jsxs)("p",{className:"text-sm text-slate-500",children:[t.issuedAt," \xb7 ",t.lengthCm.toFixed(2)," cm"]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>m(t.id),className:"rounded bg-slate-800 px-3 py-1.5 text-sm text-white hover:bg-slate-700",children:"下載"})]},t.id))})]})]})})}},96264:function(t,e,n){"use strict";n.d(e,{$F:function(){return a},EN:function(){return r},mv:function(){return c},ys:function(){return i}});let s=n(20357).env.NEXT_PUBLIC_API_URL||"http://localhost:8080";async function a(t,e,n){let a=await fetch("".concat(s,"/api/certificates"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({inquiryId:e,measurement:n})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||a.statusText);return a.json()}async function r(t){let e=await fetch("".concat(s,"/api/certificates"),{headers:{Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error(e.statusText);return e.json()}async function c(t,e){let n=await fetch("".concat(s,"/api/certificates/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(!n.ok)throw Error(n.statusText);return n.json()}async function i(t){let e=await fetch("".concat(s,"/api/certificates/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error(e.statusText);return e.json()}},59941:function(t,e,n){"use strict";function s(t){let e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),s=document.createElement("a");s.href=n,s.download="certification-".concat(t.inquiryId,"-").concat(Date.now(),".json"),s.click(),URL.revokeObjectURL(n)}n.d(e,{cP:function(){return s}})},6881:function(t,e,n){"use strict";n.d(e,{S:function(){return u}});var s,a,r=n(17327),c=n(20357);let i=null!==(s=c.env.NEXT_PUBLIC_SUPABASE_URL)&&void 0!==s?s:"",o=null!==(a=c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)&&void 0!==a?a:"",l=null;function u(){return l||(l=(0,r.eI)(i||"https://placeholder.supabase.co",o||"placeholder")),l}},48652:function(t,e,n){"use strict";n.d(e,{a:function(){return r}});var s=n(2265),a=n(6881);function r(){var t;let[e,n]=(0,s.useState)(null),[r,c]=(0,s.useState)(!0),i=(0,a.S)();return(0,s.useEffect)(()=>{i.auth.getSession().then(t=>{let{data:{session:e}}=t;n(e),c(!1)});let{data:{subscription:t}}=i.auth.onAuthStateChange((t,e)=>{n(e)});return()=>t.unsubscribe()},[i.auth]),{session:e,loading:r,accessToken:null!==(t=null==e?void 0:e.access_token)&&void 0!==t?t:null}}}},function(t){t.O(0,[138,149,971,23,744],function(){return t(t.s=31566)}),_N_E=t.O()}]);