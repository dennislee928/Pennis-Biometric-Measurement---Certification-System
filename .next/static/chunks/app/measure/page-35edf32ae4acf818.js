(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{75410:function(){},48628:function(){},31601:function(){},67792:function(){},34977:function(){},75042:function(){},82788:function(e,t,a){Promise.resolve().then(a.bind(a,77141))},77141:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var r=a(57437),n=a(2265),i=a(50965),l=a(96586);let s=!1;async function o(){if(!s)try{await l.CQI("wasm"),await l.Cd_(),s=!0}catch(e){try{await l.CQI("cpu"),await l.Cd_(),s=!0}catch(e){throw console.warn("TF.js backend init fallback failed",e),e}}}function c(e){let{data:t,width:a,height:r}=e,n=Math.floor((a-.5*a)/2),i=Math.floor(.48*r),l=Math.floor(.5*a),s=Math.floor(.35*r),o=new ImageData(l,s),c=o.data;for(let e=0;e<s;e++){let r=(i+e)*a*4,s=e*l*4;for(let e=0;e<l;e++){let a=r+(n+e)*4,i=s+4*e;c[i]=t[a],c[i+1]=t[a+1],c[i+2]=t[a+2],c[i+3]=t[a+3]}}return o}var d=a(59941),u=a(79025),m=a(97501),p=a(96264),h=a(48652),f=a(6881),g=a(35648),x=a(20357);async function v(e){var t;return void 0!==x&&(null===(t=x.env)||void 0===t?void 0:t.NEXT_PUBLIC_MEASUREMENT_RECOGNITION_MODEL_URL)?x.env.NEXT_PUBLIC_MEASUREMENT_RECOGNITION_MODEL_URL:window.__MEASUREMENT_RECOGNITION_MODEL__,{recognized:!0}}var b=a(80233),y=a(74109),w=a(77515);function N(e){let{onCapture:t,onMeasurementReady:a,referenceFrameWidthRatio:i=.25,passportAspect:l,enableBlur:s=!0,minLuminance:o=40,minBlurScore:d=2}=e,{t:u}=(0,g.Q)(),m=(0,n.useRef)(null),p=(0,n.useRef)(null),h=(0,n.useRef)(null),[f,x]=(0,n.useState)("idle"),[N,j]=(0,n.useState)(null),[C,I]=(0,n.useState)({light:!0,sharp:!0}),S=(0,n.useRef)(0),[k,P]=(0,n.useState)("idle"),[E,T]=(0,n.useState)(null),D=(0,n.useRef)(null),R=(0,n.useRef)(0),_=(0,n.useRef)(null),L=(0,n.useCallback)(()=>{h.current&&(h.current.getTracks().forEach(e=>e.stop()),h.current=null)},[]),A=(0,n.useCallback)(async()=>{j(null),x("idle");try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:1280,height:720},audio:!1});h.current=e,m.current&&(m.current.srcObject=e,await m.current.play()),x("live")}catch(e){j(e instanceof Error?e.message:u("camera.error")),x("error")}},[]);(0,n.useEffect)(()=>(A(),()=>{L()}),[A,L]);let F=(0,n.useCallback)(()=>{let e=m.current,t=p.current;if(!e||!t||e.readyState<2)return;let a=t.getContext("2d");if(!a)return;t.width=e.videoWidth,t.height=e.videoHeight,a.drawImage(e,0,0);let r=a.getImageData(0,0,t.width,t.height);I({light:function(e){let t=e.data,a=0,r=0;for(let e=0;e<t.length;e+=4)a+=.299*t[e]+.587*t[e+1]+.114*t[e+2],r++;return r>0?a/r:0}(r)>=o,sharp:function(e){let{data:t,width:a,height:r}=e,n=0,i=0;for(let e=1;e<r-1;e+=4)for(let r=1;r<a-1;r+=4){let l=(e*a+r)*4,s=(t[l]+t[l+1]+t[l+2])/3;n+=Math.abs(-((t[((e-1)*a+r)*4]+t[((e-1)*a+r)*4+1]+t[((e-1)*a+r)*4+2])/3)+2*s-(t[((e+1)*a+r)*4]+t[((e+1)*a+r)*4+1]+t[((e+1)*a+r)*4+2])/3),i++}return i>0?n/i:0}(r)>=d})},[o,d]);(0,n.useEffect)(()=>{if("live"!==f)return;let e=setInterval(()=>{Date.now()-S.current<500||(S.current=Date.now(),F())},800);return()=>clearInterval(e)},[f,F]);let M=(0,n.useCallback)(()=>{_.current&&(clearInterval(_.current),_.current=null)},[]),O=(0,n.useCallback)(()=>{T(null),P("capturing"),D.current=null,R.current=Date.now()},[]);(0,n.useEffect)(()=>{if("capturing"!==k)return;let e=m.current,a=p.current;if(!e||!a||e.readyState<2)return;let r=a.getContext("2d");if(r)return _.current=setInterval(()=>{if(!e||!a||e.readyState<2)return;a.width=e.videoWidth,a.height=e.videoHeight,r.drawImage(e,0,0);let n=r.getImageData(0,0,a.width,a.height),i=c(n);if(Date.now()-R.current>3e3){M(),P("timeout");return}let l=D.current;if(D.current=i,l&&function(e,t){if(e.width!==t.width||e.height!==t.height)return 0;let a=e.data,r=t.data,n=0,i=0;for(let e=0;e<a.length;e+=4)n+=Math.abs(.299*a[e]+.587*a[e+1]+.114*a[e+2]-(.299*r[e]+.587*r[e+1]+.114*r[e+2])),i++;return i>0?n/i:0}(l,i)>=4){M();let e=new ImageData(new Uint8ClampedArray(n.data),n.width,n.height);if(!function(e){var t,a;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:n,width:i,height:l}=c(e),s=null!==(t=r.minVariance)&&void 0!==t?t:80,o=null!==(a=r.minEdgeScore)&&void 0!==a?a:1.5,d=0,u=0,m=0;for(let e=0;e<n.length;e+=8){let t=.299*n[e]+.587*n[e+1]+.114*n[e+2];d+=t,u+=t*t,m++}let p=m>0?d/m:0;if((m>0?u/m-p*p:0)<s)return{valid:!1,reason:"region_empty_or_flat"};let h=0,f=0;for(let e=1;e<l-1;e+=2)for(let t=1;t<i-1;t+=2){let a=(e*i+t)*4,r=(n[a]+n[a+1]+n[a+2])/3;h+=Math.abs(-((n[((e-1)*i+t)*4]+n[((e-1)*i+t)*4+1]+n[((e-1)*i+t)*4+2])/3)+2*r-(n[((e+1)*i+t)*4]+n[((e+1)*i+t)*4+1]+n[((e+1)*i+t)*4+2])/3),f++}return(f>0?h/f:0)<o?{valid:!1,reason:"region_no_contour"}:{valid:!0}}(e).valid){T(u("validation.regionInvalid")),P("idle");return}v(c(e)).then(a=>{if(!a.recognized){T(u("validation.regionInvalid")),P("idle");return}null==t||t(e,!0),x("captured"),P("idle")})}},220),()=>M()},[k,M,t,u]);let q=(0,n.useCallback)(()=>{P("idle"),T(null)},[]),z=(0,n.useCallback)(()=>{O()},[O]),U=(0,n.useCallback)(()=>{x("live"),P("idle"),T(null),D.current=null},[]),H=640*i,J=72+H*(null!=l?l:85.6/53.98),B=480*.48;return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsxs)("div",{className:"relative overflow-hidden rounded-xl bg-black",style:{width:640,height:480},children:[(0,r.jsx)("video",{ref:m,autoPlay:!0,playsInline:!0,muted:!0,className:"h-full w-full object-cover ".concat(s?"sensitive-blur":""),style:{transform:"scaleX(-1)"}}),(0,r.jsx)("canvas",{ref:p,className:"hidden"}),"live"===f&&(0,r.jsxs)("div",{className:"camera-overlay",children:[(0,r.jsx)("div",{className:"camera-overlay__frame",style:{left:(640-H)/2,top:72,width:H,height:J-72}}),(0,r.jsx)("div",{className:"camera-overlay__frame-measurement",style:{left:160,top:B,width:320,height:168}}),"capturing"!==k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"camera-overlay__hint",style:{left:0,right:0,top:44},children:u("reference.passportHint")}),(0,r.jsx)("div",{className:"camera-overlay__hint",style:{left:0,right:0,top:B-24},children:u("reference.measurementFrameHint")}),(0,r.jsx)("div",{className:"camera-overlay__hint",style:{left:0,right:0,bottom:24},children:u("reference.captureHint")})]}),"capturing"===k&&(0,r.jsx)("div",{className:"camera-overlay__hint",style:{left:8,right:8,bottom:24,fontSize:"0.8rem"},children:u("liveness.prompt")})]})]}),"live"===f&&"capturing"!==k&&(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,r.jsx)("span",{className:C.light?"text-green-600":"text-amber-600",children:C.light?u("camera.bright"):u("camera.dark")}),(0,r.jsx)("span",{className:C.sharp?"text-green-600":"text-amber-600",children:C.sharp?u("camera.sharp"):u("camera.blur")})]}),E&&(0,r.jsxs)("div",{className:"w-full rounded-lg bg-amber-50 p-4 text-amber-900 text-sm",children:[E,(0,r.jsx)("button",{type:"button",onClick:()=>T(null),className:"mt-2 block text-amber-700 underline",children:u("liveness.retry")})]}),"live"===f&&"idle"===k&&!E&&(0,r.jsxs)("button",{type:"button",onClick:z,disabled:!C.light||!C.sharp,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-6 py-3 text-white transition hover:bg-emerald-700 disabled:opacity-50",children:[(0,r.jsx)(b.Z,{className:"h-5 w-5"}),u("camera.capture")]}),"live"===f&&"capturing"===k&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[(0,r.jsx)(y.Z,{className:"h-5 w-5 animate-spin"}),u("liveness.prompt")]}),"live"===f&&"timeout"===k&&(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsx)("p",{className:"text-sm text-amber-700",children:u("liveness.timeout")}),(0,r.jsx)("button",{type:"button",onClick:q,className:"rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",children:u("liveness.retry")})]}),"captured"===f&&(0,r.jsx)("button",{type:"button",onClick:U,className:"rounded-lg border border-slate-300 bg-white px-4 py-2 text-slate-700 hover:bg-slate-50",children:u("camera.retake")}),"error"===f&&(0,r.jsxs)("div",{className:"flex items-center gap-2 rounded-lg bg-red-50 p-4 text-red-800",children:[(0,r.jsx)(w.Z,{className:"h-5 w-5 shrink-0"}),(0,r.jsx)("span",{children:N}),(0,r.jsx)("button",{type:"button",onClick:A,className:"ml-2 rounded bg-red-100 px-3 py-1 text-sm hover:bg-red-200",children:u("camera.retry")})]}),"idle"===f&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-slate-500",children:[(0,r.jsx)(y.Z,{className:"h-5 w-5 animate-spin"}),u("camera.starting")]})]})}let j="https://cdn.withpersona.com/dist/persona-v4.8.0.js";var C=a(37164),I=a(20500),S=a(15862),k=a(87138);let P=125/88;function E(){var e,t;let{t:a,locale:l}=(0,g.Q)(),[s,c]=(0,n.useState)("camera"),[x,v]=(0,n.useState)(null),[b,w]=(0,n.useState)(null),[E,T]=(0,n.useState)(null),[D,R]=(0,n.useState)(""),[_,L]=(0,n.useState)(!1),[A,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o().catch(()=>{})},[]);let M=(0,n.useCallback)((e,t)=>{let a=function(e,t){var a;let{width:r,height:n}=e,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8.56,[a,r,n,i]=e,l=(Math.hypot(r.x-a.x,r.y-a.y)+Math.hypot(n.x-i.x,n.y-i.y))/2;return l<=0?0:l/t}(function(e,t){let a=.25*e,r=(e-a)/2,n=.15*t,i=a*P;return[{x:r,y:n},{x:r+a,y:n},{x:r+a,y:n+i},{x:r,y:n+i}]}(r,n),8.8);return i<=0?null:(a=.35*n,{lengthCm:i<=0?0:a/i,ppm:i,timestamp:Date.now(),liveCaptured:t})}(e,t);a&&(v(a),c("measure"))},[]),{ready:O,error:q,open:z}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sandbox",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[r,i]=(0,n.useState)(!1),[l,s]=(0,n.useState)(null),o=(0,n.useRef)(null),{onComplete:c,onCancel:d,onError:u}=a,m=(0,n.useCallback)(()=>{o.current&&o.current.open()},[]);return(0,n.useEffect)(()=>{if(!e)return;if(document.querySelector('script[src="'.concat(j,'"]'))){var a;if(null===(a=window.Persona)||void 0===a?void 0:a.Client)try{let a=new window.Persona.Client({templateId:e,environment:t,onReady:()=>i(!0),onComplete:e=>null==c?void 0:c(e),onCancel:e=>null==d?void 0:d(e),onError:e=>{s(String(e)),null==u||u(e)}});o.current=a,i(!0)}catch(e){s(e instanceof Error?e.message:"Persona 初始化失敗")}return}let r=document.createElement("script");return r.src=j,r.async=!0,r.onload=()=>{var a;if(!(null===(a=window.Persona)||void 0===a?void 0:a.Client)){s("Persona SDK 載入失敗");return}try{let a=new window.Persona.Client({templateId:e,environment:t,onReady:()=>{i(!0),s(null)},onComplete:e=>null==c?void 0:c(e),onCancel:e=>null==d?void 0:d(e),onError:e=>{s(String(e)),null==u||u(e)}});o.current=a}catch(e){s(e instanceof Error?e.message:"Persona 初始化失敗"),null==u||u(e)}},r.onerror=()=>{s("Persona 腳本載入失敗")},document.body.appendChild(r),()=>{o.current=null,i(!1)}},[e,t,c,d,u]),{ready:r,error:l,open:m}}("itmpl_xxxxxxxx","sandbox",{onComplete:e=>{let{inquiryId:t}=e;T(t),c("cert")},onError:()=>{}}),{session:U,accessToken:H}=(0,h.a)(),[J,B]=(0,n.useState)(null),W=(0,n.useCallback)(()=>{c("verify"),z()},[z]),Z=(0,n.useCallback)(async()=>{if(E&&x&&H){B(null);try{let e=await (0,p.$F)(H,E,x);w(e),(0,d.cP)(e),(0,i.Z)({particleCount:80,spread:60})}catch(e){B(e instanceof Error?e.message:a("error.issueFailed"))}}},[E,x,H,a]),V=x?{holderName:D,lengthCm:x.lengthCm,issuedAt:null!==(t=null==b?void 0:b.issuedAt)&&void 0!==t?t:new Date().toISOString(),inquiryId:null!=E?E:void 0}:null,G=(0,n.useCallback)(()=>{V&&(!function(e,t){let a=function(e,t){var a,r,n,i,l,s;let o=document.createElement("canvas");o.width=600,o.height=400;let c=o.getContext("2d"),d=u.s[t];c.fillStyle="#ffffff",c.fillRect(0,0,600,400),c.strokeStyle="#1e293b",c.lineWidth=3,c.strokeRect(8,8,584,384),c.strokeStyle="#334155",c.lineWidth=1,c.strokeRect(14,14,572,372),c.save(),c.globalAlpha=.06,c.fillStyle="#0f172a",c.font="bold 72px system-ui, sans-serif",c.textAlign="center",c.textBaseline="middle",c.fillText("Dick Size Verified",300,200),c.restore(),c.fillStyle="#0f172a",c.font="bold 22px system-ui, sans-serif",c.textAlign="center",c.fillText(null!==(a=d["cert.title"])&&void 0!==a?a:"Biometric Measurement Certificate",300,68),c.strokeStyle="#0d9488",c.lineWidth=2,c.beginPath(),c.moveTo(120,82),c.lineTo(480,82),c.stroke(),function(e,t,a,r){e.save(),e.strokeStyle="#0d9488",e.fillStyle="rgba(13, 148, 136, 0.08)",e.lineWidth=2.5,e.beginPath(),e.arc(530,72,36,0,2*Math.PI),e.fill(),e.stroke(),e.strokeStyle="#0f766e",e.lineWidth=1.5,e.beginPath(),e.arc(530,72,32,0,2*Math.PI),e.stroke();let n=16.2;e.strokeStyle="#0d9488",e.lineWidth=2.5,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t-.9*n,72),e.lineTo(t-.2*n,a+.7*n),e.lineTo(t+.85*n,a-.7*n),e.stroke(),e.restore()}(c,530,72,36),c.font="16px system-ui, sans-serif",c.textAlign="left";let m=40+78.39999999999999;return c.fillStyle="#0f172a",c.fillText("".concat(null!==(r=d["cert.holder"])&&void 0!==r?r:"Holder",": ").concat(e.holderName||"—"),40,m),m+=28,c.fillText("".concat(null!==(n=d["cert.length"])&&void 0!==n?n:"Length",": ").concat(e.lengthCm.toFixed(2)," cm"),40,m),m+=28,c.fillText("".concat(null!==(i=d["cert.issuedAt"])&&void 0!==i?i:"Issued at",": ").concat(e.issuedAt),40,m),e.inquiryId&&(m+=28,c.fillText("".concat(null!==(l=d["cert.inquiryId"])&&void 0!==l?l:"Inquiry ID",": ").concat(e.inquiryId),40,m)),m=332,c.font="11px system-ui, sans-serif",c.fillStyle="#64748b",c.textAlign="center",c.fillText(null!==(s=d["cert.footer"])&&void 0!==s?s:"On-device measurement. Identity verified via Persona.",300,m),o.toDataURL("image/png")}(e,t),r=document.createElement("a");r.href=a,r.download="certificate-".concat(Date.now(),".png"),r.click()}(V,l),L(!0))},[V,l]),X=(0,n.useCallback)(()=>{V&&(!function(e,t){var a,r,n,i,l,s;let o=new m.kH,c=u.s[t];o.setDrawColor(30,41,59),o.setLineWidth(.8),o.rect(8,8,194,281,"S"),o.setDrawColor(51,65,85),o.setLineWidth(.25),o.rect(12,12,186,273,"S"),o.setTextColor(200,203,210),o.setFontSize(48),o.setFont("helvetica","bold"),o.text("Dick Size Verified",105,148.5,{align:"center"}),o.setTextColor(0,0,0);let d=28;o.setFontSize(18),o.setFont("helvetica","bold"),o.setTextColor(15,23,42),o.text(null!==(a=c["cert.title"])&&void 0!==a?a:"Biometric Measurement Certificate",105,d,{align:"center"}),d+=4,o.setDrawColor(13,148,136),o.setLineWidth(.5),o.line(30,d,180,d),d+=14,function(e,t,a,r){e.setDrawColor(13,148,136),e.setLineWidth(.4),e.setFillColor(240,253,250),e.circle(178,38,12,"FD"),e.setDrawColor(15,118,110),e.setLineWidth(.25),e.circle(178,38,10,"S");let n=5.4;e.setDrawColor(13,148,136),e.setLineWidth(.5),e.line(t-.9*n,38,t-.2*n,a+.7*n),e.line(t-.2*n,a+.7*n,t+.85*n,a-.7*n)}(o,178,38,12),o.setFontSize(12),o.setFont("helvetica","normal"),o.setTextColor(15,23,42),o.text("".concat(null!==(r=c["cert.holder"])&&void 0!==r?r:"Holder",": ").concat(e.holderName||"—"),20,d),d+=10,o.text("".concat(null!==(n=c["cert.length"])&&void 0!==n?n:"Length",": ").concat(e.lengthCm.toFixed(2)," cm"),20,d),d+=10,o.text("".concat(null!==(i=c["cert.issuedAt"])&&void 0!==i?i:"Issued at",": ").concat(e.issuedAt),20,d),d+=10,e.inquiryId&&(o.text("".concat(null!==(l=c["cert.inquiryId"])&&void 0!==l?l:"Inquiry ID",": ").concat(e.inquiryId),20,d),d+=10),d=275,o.setFontSize(9),o.setTextColor(100,116,139),o.text(null!==(s=c["cert.footer"])&&void 0!==s?s:"On-device measurement. Identity verified via Persona.",105,d,{align:"center"}),o.save("certificate-".concat(Date.now(),".pdf"))}(V,l),F(!0))},[V,l]);return(0,r.jsxs)("main",{className:"min-h-screen bg-slate-50 px-4 py-8",children:[(0,r.jsxs)("nav",{className:"mx-auto mb-6 flex max-w-2xl items-center justify-between text-sm",children:[(0,r.jsx)(k.default,{href:"/",className:"text-slate-600 hover:text-slate-900",children:a("nav.home")}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(k.default,{href:"/verify",className:"text-slate-600 hover:text-slate-900",children:a("nav.verify")}),(0,r.jsx)(k.default,{href:"/certificates",className:"text-slate-600 hover:text-slate-900",children:a("nav.myCerts")}),U?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-slate-500",children:null===(e=U.user)||void 0===e?void 0:e.email}),(0,r.jsx)("button",{type:"button",onClick:()=>(0,f.S)().auth.signOut(),className:"text-slate-600 hover:text-slate-900",children:a("nav.logout")})]}):(0,r.jsx)(k.default,{href:"/login",className:"rounded bg-slate-800 px-3 py-1.5 text-white hover:bg-slate-700",children:a("nav.login")})]})]}),(0,r.jsxs)("div",{className:"mx-auto max-w-2xl space-y-8",children:[(0,r.jsxs)("header",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:a("welcome.title")}),(0,r.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:a("welcome.subtitle")})]}),"camera"===s&&(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:a("step1.title")}),(0,r.jsx)("p",{className:"mb-4 text-sm text-slate-600",children:a("step1.hint")}),(0,r.jsx)(N,{onCapture:M,referenceFrameWidthRatio:.25,passportAspect:P,enableBlur:!0})]}),"measure"===s&&x&&(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:a("step2.title")}),(0,r.jsxs)("div",{className:"mb-4 rounded-lg bg-slate-100 p-4",children:[(0,r.jsx)("p",{className:"text-sm text-slate-600",children:a("step2.length")}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-slate-900",children:[x.lengthCm.toFixed(2)," cm"]}),(0,r.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:[a("step2.live"),": ",x.liveCaptured?a("step2.yes"):a("step2.no")," \xb7 PPM: ",x.ppm.toFixed(1)]})]}),(0,r.jsxs)("div",{className:"mb-4 border-t border-slate-200 pt-4",children:[(0,r.jsx)("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:a("step2.certSectionTitle")}),(0,r.jsx)("label",{htmlFor:"step2-holder-name",className:"mb-1 block text-sm font-medium text-slate-700",children:a("step4.holderName")}),(0,r.jsx)("input",{id:"step2-holder-name",type:"text",value:D,onChange:e=>R(e.target.value),placeholder:a("step4.holderNamePlaceholder"),className:"mb-4 w-full rounded border border-slate-300 px-3 py-2 text-slate-900 placeholder:text-slate-400"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsxs)("button",{type:"button",onClick:G,className:"inline-flex items-center gap-2 rounded-lg bg-slate-700 px-4 py-2 text-sm text-white hover:bg-slate-800",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),a("step4.downloadPng")]}),(0,r.jsxs)("button",{type:"button",onClick:X,className:"inline-flex items-center gap-2 rounded-lg bg-slate-700 px-4 py-2 text-sm text-white hover:bg-slate-800",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),a("step4.downloadPdf")]})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>c("camera"),className:"rounded-lg border border-slate-300 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50",children:a("step2.retake")}),(0,r.jsx)("button",{type:"button",onClick:W,disabled:!O,className:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700 disabled:opacity-50",children:O?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I.Z,{className:"h-4 w-4"}),a("step2.verify")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{className:"h-4 w-4 animate-spin"}),a("step2.loading")]})})]}),q&&(0,r.jsx)("p",{className:"mt-2 text-sm text-amber-600",children:q})]}),"verify"===s&&(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:a("step3.title")}),(0,r.jsx)("p",{className:"mb-4 text-sm text-slate-600",children:a("step3.hint")}),(0,r.jsx)("button",{type:"button",onClick:z,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",children:a("step3.openAgain")})]}),"cert"===s&&x&&(0,r.jsxs)("section",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:a("step4.title")}),E&&(0,r.jsxs)("p",{className:"mb-4 text-sm text-slate-600",children:[a("step4.inquiryId"),": ",(0,r.jsx)("code",{className:"rounded bg-slate-100 px-1",children:E})]}),H&&(0,r.jsx)("div",{className:"mb-4 rounded-lg bg-emerald-50 p-4",children:(0,r.jsxs)("p",{className:"flex items-center gap-2 text-emerald-800",children:[(0,r.jsx)(S.Z,{className:"h-5 w-5"}),a("step4.certReady")]})}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"holder-name",className:"mb-1 block text-sm font-medium text-slate-700",children:a("step4.holderName")}),(0,r.jsx)("input",{id:"holder-name",type:"text",value:D,onChange:e=>R(e.target.value),placeholder:a("step4.holderNamePlaceholder"),className:"w-full rounded border border-slate-300 px-3 py-2 text-slate-900 placeholder:text-slate-400"})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-wrap gap-3",children:[(0,r.jsxs)("button",{type:"button",onClick:G,disabled:_,className:"inline-flex items-center gap-2 rounded-lg bg-slate-700 px-4 py-2 text-white hover:bg-slate-800 disabled:opacity-60 disabled:cursor-not-allowed",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),_?a("step4.downloaded"):a("step4.downloadPng")]}),(0,r.jsxs)("button",{type:"button",onClick:X,disabled:A,className:"inline-flex items-center gap-2 rounded-lg bg-slate-700 px-4 py-2 text-white hover:bg-slate-800 disabled:opacity-60 disabled:cursor-not-allowed",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),A?a("step4.downloaded"):a("step4.downloadPdf")]})]}),H?(0,r.jsxs)(r.Fragment,{children:[J&&(0,r.jsx)("p",{className:"mb-2 text-sm text-red-600",children:J}),(0,r.jsxs)("button",{type:"button",onClick:Z,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-700",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),a("step4.downloadJson")]})]}):(0,r.jsxs)("div",{className:"rounded-lg bg-amber-50 p-4 text-amber-800",children:[(0,r.jsx)("p",{className:"mb-2",children:a("step4.loginRequiredJson")}),(0,r.jsx)(k.default,{href:"/login",className:"text-sm font-medium underline",children:a("step4.goLogin")})]})]})]})]})}},96264:function(e,t,a){"use strict";a.d(t,{$F:function(){return n},EN:function(){return i},mv:function(){return l},ys:function(){return s}});let r=a(20357).env.NEXT_PUBLIC_API_URL||"http://localhost:8080";async function n(e,t,a){let n=await fetch("".concat(r,"/api/certificates"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({inquiryId:t,measurement:a})});if(!n.ok)throw Error((await n.json().catch(()=>({}))).error||n.statusText);return n.json()}async function i(e){let t=await fetch("".concat(r,"/api/certificates"),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(t.statusText);return t.json()}async function l(e,t){let a=await fetch("".concat(r,"/api/certificates/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw Error(a.statusText);return a.json()}async function s(e){let t=await fetch("".concat(r,"/api/certificates/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(t.statusText);return t.json()}},59941:function(e,t,a){"use strict";function r(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="certification-".concat(e.inquiryId,"-").concat(Date.now(),".json"),r.click(),URL.revokeObjectURL(a)}a.d(t,{cP:function(){return r}})},35648:function(e,t,a){"use strict";a.d(t,{I18nProvider:function(){return o},Q:function(){return c}});var r=a(57437),n=a(2265),i=a(79025);let l="locale",s=(0,n.createContext)(null);function o(e){let{children:t}=e,[a,o]=(0,n.useState)("en"),[c,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o(function(){if("undefined"==typeof document)return"en";let e=document.cookie.match(new RegExp("(?:^|; )".concat(l,"=([^;]*)"))),t=e?decodeURIComponent(e[1]):"";return"zh-TW"===t||"ja"===t||"es"===t||"en"===t?t:"en"}()),d(!0)},[]);let u=(0,n.useCallback)(e=>{o(e),document.cookie="".concat(l,"=").concat(encodeURIComponent(e),";path=/;max-age=31536000")},[]),m=(0,n.useCallback)(e=>{var t;let r=i.s[a];return null!==(t=null==r?void 0:r[e])&&void 0!==t?t:e},[a]);return(0,n.useEffect)(()=>{c&&"undefined"!=typeof document&&(document.documentElement.lang="zh-TW"===a?"zh-TW":"ja"===a?"ja":"es"===a?"es":"en")},[a,c]),(0,r.jsx)(s.Provider,{value:{locale:a,setLocale:u,t:m},children:t})}function c(){let e=(0,n.useContext)(s);if(!e)throw Error("useI18n must be used within I18nProvider");return e}},79025:function(e,t,a){"use strict";a.d(t,{s:function(){return r}});let r={en:{"welcome.title":"Male Penis Length & Size Measurement","welcome.subtitle":"On-device measurement of male penis length and size. No images leave your device. Identity verification for a digital certificate.","welcome.disclaimer":"For personal reference only. Not for medical diagnosis. Adult use only. Sensitive content.","welcome.noticeTitle":"User Notice","welcome.noticeItems":"Images are processed only on your device and are not stored on our servers.\nYou must be 18 years or older to use this service.\nThis service is for personal use only and does not replace professional medical advice.","welcome.start":"Start measurement","nav.verify":"Verify certificate","nav.myCerts":"My certificates","nav.login":"Log in","nav.logout":"Log out","nav.home":"Home","step1.title":"Step 1 Camera capture","step1.hint":"Align passport (closed) with the green frame and place the measurement subject in the blue frame. Ensure good lighting, then capture.","step2.title":"Step 2 Measurement result","step2.length":"Length (cm)","step2.live":"Live capture","step2.yes":"Yes","step2.no":"No","step2.retake":"Retake","step2.verify":"Verify identity","step2.loading":"Loading…","step2.certSectionTitle":"Generate certificates","step3.title":"Step 3 Identity verification (Persona)","step3.hint":"Complete government ID and face scan in the popup. You will then proceed to the certificate step.","step3.openAgain":"Open verification again","step4.title":"Step 4 Digital certificate","step4.inquiryId":"Verification ID","step4.loginRequired":"Please log in to download the certificate.","step4.loginRequiredJson":"Please log in to download the certificate JSON.","step4.goLogin":"Go to login","step4.certReady":"Digital certificate (backend-signed) is ready.","step4.downloadJson":"Download certificate JSON","step4.downloadPng":"Download certificate PNG","step4.downloadPdf":"Download certificate PDF","step4.downloaded":"Downloaded","step4.holderName":"Holder name","step4.holderNamePlaceholder":"Enter your name","reference.passportHint":"Align passport (closed) with the green frame","reference.measurementFrameHint":"Place measurement subject in the blue frame","reference.captureHint":"Then tap Capture","liveness.prompt":"Please gently move or rotate within the blue frame to complete verification.","liveness.detected":"Motion detected, capturing…","liveness.timeout":"No motion detected. Please try again.","liveness.retry":"Retry","validation.regionInvalid":"Please align the measurement subject in the blue frame and ensure it is clearly visible.","camera.bright":"Bright enough","camera.dark":"Low light","camera.sharp":"Sharp","camera.blur":"Blurred","camera.capture":"Capture","camera.retake":"Retake","camera.starting":"Starting camera…","camera.error":"Cannot access camera","camera.retry":"Retry","cert.title":"Male Penis Length Measurement Certificate","cert.holder":"Holder","cert.length":"Length","cert.issuedAt":"Issued at","cert.inquiryId":"Inquiry ID","cert.footer":"On-device measurement. Identity verified via Persona.","error.issueFailed":"Certificate issue failed"},"zh-TW":{"welcome.title":"男性陰莖長度與尺寸測量","welcome.subtitle":"本服務用於測量男性陰莖長度與尺寸。端上測量 \xb7 影像不離裝置 \xb7 身分驗證後取得數位證書","welcome.disclaimer":"僅供個人參考，非醫療診斷用途。限成人使用。敏感內容。","welcome.noticeTitle":"使用者須知","welcome.noticeItems":"影像僅於您裝置內處理，不會上傳或儲存於我們的伺服器。\n使用本服務須年滿 18 歲。\n本服務僅供個人使用，無法取代專業醫療建議。","welcome.start":"開始測量","nav.verify":"驗證證書","nav.myCerts":"我的證書","nav.login":"登入","nav.logout":"登出","nav.home":"首頁","step1.title":"步驟 1 相機擷取","step1.hint":"請將護照（閉合）對齊綠色框，並將測量部位對齊藍色框，光線充足、畫面清晰後擷取。","step2.title":"步驟 2 測量結果","step2.length":"長度（公分）","step2.live":"即時擷取","step2.yes":"是","step2.no":"否","step2.retake":"重新拍攝","step2.verify":"進行身分驗證","step2.loading":"載入驗證…","step2.certSectionTitle":"產生證書","step3.title":"步驟 3 身分驗證 (Persona)","step3.hint":"請在彈窗中完成政府證件與人臉掃描。完成後將自動進入證書步驟。","step3.openAgain":"再次開啟驗證","step4.title":"步驟 4 數位證書","step4.inquiryId":"身分驗證 ID","step4.loginRequired":"請先登入後再下載證書。","step4.loginRequiredJson":"請先登入後再下載證書 JSON。","step4.goLogin":"前往登入","step4.certReady":"可下載數位認證證書（後端簽名）","step4.downloadJson":"下載證書 JSON","step4.downloadPng":"下載證書 PNG","step4.downloadPdf":"下載證書 PDF","step4.downloaded":"已下載","step4.holderName":"持有人姓名","step4.holderNamePlaceholder":"請輸入您的姓名","reference.passportHint":"請將護照（閉合）對齊綠色框","reference.measurementFrameHint":"請將測量部位對齊藍色框","reference.captureHint":"對齊後按下「擷取」","liveness.prompt":"請在藍色框內輕微晃動或旋轉以完成活體驗證。","liveness.detected":"已偵測到動作，正在擷取…","liveness.timeout":"未偵測到動作，請重試。","liveness.retry":"重試","validation.regionInvalid":"請將測量部位對齊藍色框，並確保清楚可見。","camera.bright":"亮度足夠","camera.dark":"光線不足","camera.sharp":"畫面清晰","camera.blur":"畫面模糊","camera.capture":"擷取","camera.retake":"重新拍攝","camera.starting":"正在啟動相機…","camera.error":"無法取得相機","camera.retry":"重試","cert.title":"男性陰莖長度測量證書","cert.holder":"持有人","cert.length":"長度","cert.issuedAt":"發證日期","cert.inquiryId":"驗證 ID","cert.footer":"端上測量，身分經 Persona 驗證。","error.issueFailed":"簽發失敗"},ja:{"welcome.title":"男性ペニス長・サイズ測定","welcome.subtitle":"男性ペニスの長さ・サイズを端末上で測定。画像は端末外に送信されません。本人確認後にデジタル証明書を発行。","welcome.disclaimer":"個人の参考用です。医療診断には使用できません。成人のみご利用ください。センシティブなコンテンツです。","welcome.noticeTitle":"ご利用上の注意","welcome.noticeItems":"画像はお使いの端末内でのみ処理され、当社サーバーには保存されません。\n本サービスは18歳以上の方のみご利用いただけます。\n個人利用に限り、専門的な医療アドバイスに代わるものではありません。","welcome.start":"測定を開始","nav.verify":"証明書を検証","nav.myCerts":"マイ証明書","nav.login":"ログイン","nav.logout":"ログアウト","nav.home":"ホーム","step1.title":"ステップ 1 カメラ撮影","step1.hint":"パスポート（閉じた状態）を緑の枠に、測定部位を青の枠に合わせ、明るさとピントを確認してから撮影してください。","step2.title":"ステップ 2 測定結果","step2.length":"長さ（cm）","step2.live":"ライブ撮影","step2.yes":"はい","step2.no":"いいえ","step2.retake":"再撮影","step2.verify":"本人確認を行う","step2.loading":"読み込み中…","step2.certSectionTitle":"証明書を発行","step3.title":"ステップ 3 本人確認 (Persona)","step3.hint":"ポップアップで公的身分証と顔スキャンを完了してください。完了後、証明書のステップに進みます。","step3.openAgain":"もう一度本人確認を開く","step4.title":"ステップ 4 デジタル証明書","step4.inquiryId":"検証 ID","step4.loginRequired":"証明書をダウンロードするにはログインしてください。","step4.loginRequiredJson":"証明書 JSON をダウンロードするにはログインしてください。","step4.goLogin":"ログインへ","step4.certReady":"デジタル証明書（バックエンド署名済み）の準備ができました。","step4.downloadJson":"証明書 JSON をダウンロード","step4.downloadPng":"証明書 PNG をダウンロード","step4.downloadPdf":"証明書 PDF をダウンロード","step4.downloaded":"ダウンロード済み","step4.holderName":"保有者名","step4.holderNamePlaceholder":"お名前を入力","reference.passportHint":"パスポート（閉じた状態）を緑の枠に合わせてください","reference.measurementFrameHint":"測定部位を青の枠に合わせてください","reference.captureHint":"合わせたら「撮影」を押してください","liveness.prompt":"青の枠内で軽く動かすか回転させて、本人確認を完了してください。","liveness.detected":"動作を検出しました。撮影中…","liveness.timeout":"動作が検出されませんでした。もう一度お試しください。","liveness.retry":"再試行","validation.regionInvalid":"測定部位を青の枠に合わせ、はっきり見えるようにしてください。","camera.bright":"十分な明るさ","camera.dark":"暗い","camera.sharp":"くっきり","camera.blur":"ぼやけ","camera.capture":"撮影","camera.retake":"再撮影","camera.starting":"カメラを起動しています…","camera.error":"カメラにアクセスできません","camera.retry":"再試行","cert.title":"男性ペニス長測定証明書","cert.holder":"保有者","cert.length":"長さ","cert.issuedAt":"発行日","cert.inquiryId":"照会 ID","cert.footer":"端末上で測定。Persona により本人確認済み。","error.issueFailed":"証明書の発行に失敗しました"},es:{"welcome.title":"Medici\xf3n de longitud y tama\xf1o del pene masculino","welcome.subtitle":"Medici\xf3n en dispositivo de longitud y tama\xf1o del pene masculino. Las im\xe1genes no salen del dispositivo. Verificaci\xf3n de identidad para certificado digital.","welcome.disclaimer":"Solo para referencia personal. No es un diagn\xf3stico m\xe9dico. Solo para mayores de edad. Contenido sensible.","welcome.noticeTitle":"Aviso al usuario","welcome.noticeItems":"Las im\xe1genes se procesan solo en su dispositivo y no se almacenan en nuestros servidores.\nDebe tener 18 a\xf1os o m\xe1s para usar este servicio.\nEste servicio es solo para uso personal y no sustituye el consejo m\xe9dico profesional.","welcome.start":"Iniciar medici\xf3n","nav.verify":"Verificar certificado","nav.myCerts":"Mis certificados","nav.login":"Iniciar sesi\xf3n","nav.logout":"Cerrar sesi\xf3n","nav.home":"Inicio","step1.title":"Paso 1 Captura de c\xe1mara","step1.hint":"Alinee el pasaporte (cerrado) con el marco verde y coloque el objeto de medici\xf3n en el marco azul. Buena iluminaci\xf3n, luego capture.","step2.title":"Paso 2 Resultado de medici\xf3n","step2.length":"Longitud (cm)","step2.live":"Captura en vivo","step2.yes":"S\xed","step2.no":"No","step2.retake":"Volver a capturar","step2.verify":"Verificar identidad","step2.loading":"Cargando…","step2.certSectionTitle":"Generar certificados","step3.title":"Paso 3 Verificaci\xf3n de identidad (Persona)","step3.hint":"Complete el documento de identidad y el escaneo facial en la ventana emergente. Luego pasar\xe1 al paso del certificado.","step3.openAgain":"Abrir verificaci\xf3n de nuevo","step4.title":"Paso 4 Certificado digital","step4.inquiryId":"ID de verificaci\xf3n","step4.loginRequired":"Inicie sesi\xf3n para descargar el certificado.","step4.loginRequiredJson":"Inicie sesi\xf3n para descargar el certificado JSON.","step4.goLogin":"Ir a iniciar sesi\xf3n","step4.certReady":"Certificado digital (firmado por el servidor) listo.","step4.downloadJson":"Descargar certificado JSON","step4.downloadPng":"Descargar certificado PNG","step4.downloadPdf":"Descargar certificado PDF","step4.downloaded":"Descargado","step4.holderName":"Nombre del titular","step4.holderNamePlaceholder":"Introduzca su nombre","reference.passportHint":"Alinee el pasaporte (cerrado) con el marco verde","reference.measurementFrameHint":"Coloque el objeto de medici\xf3n en el marco azul","reference.captureHint":"Luego pulse \xabCapturar\xbb","liveness.prompt":"Mueva o gire suavemente dentro del marco azul para completar la verificaci\xf3n.","liveness.detected":"Movimiento detectado, capturando…","liveness.timeout":"No se detect\xf3 movimiento. Int\xe9ntelo de nuevo.","liveness.retry":"Reintentar","validation.regionInvalid":"Alinee el objeto de medici\xf3n en el marco azul y aseg\xfarese de que sea claramente visible.","camera.bright":"Suficiente luz","camera.dark":"Poca luz","camera.sharp":"Nitido","camera.blur":"Borrosso","camera.capture":"Capturar","camera.retake":"Volver a capturar","camera.starting":"Iniciando c\xe1mara…","camera.error":"No se puede acceder a la c\xe1mara","camera.retry":"Reintentar","cert.title":"Certificado de medici\xf3n de longitud del pene masculino","cert.holder":"Titular","cert.length":"Longitud","cert.issuedAt":"Fecha de emisi\xf3n","cert.inquiryId":"ID de consulta","cert.footer":"Medici\xf3n en dispositivo. Identidad verificada por Persona.","error.issueFailed":"Error al emitir el certificado"}}},6881:function(e,t,a){"use strict";a.d(t,{S:function(){return d}});var r,n,i=a(17327),l=a(20357);let s=null!==(r=l.env.NEXT_PUBLIC_SUPABASE_URL)&&void 0!==r?r:"",o=null!==(n=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)&&void 0!==n?n:"",c=null;function d(){return c||(c=(0,i.eI)(s||"https://placeholder.supabase.co",o||"placeholder")),c}},48652:function(e,t,a){"use strict";a.d(t,{a:function(){return i}});var r=a(2265),n=a(6881);function i(){var e;let[t,a]=(0,r.useState)(null),[i,l]=(0,r.useState)(!0),s=(0,n.S)();return(0,r.useEffect)(()=>{s.auth.getSession().then(e=>{let{data:{session:t}}=e;a(t),l(!1)});let{data:{subscription:e}}=s.auth.onAuthStateChange((e,t)=>{a(t)});return()=>e.unsubscribe()},[s.auth]),{session:t,loading:i,accessToken:null!==(e=null==t?void 0:t.access_token)&&void 0!==e?e:null}}}},function(e){e.O(0,[505,425,399,663,566,636,938,498,138,149,838,971,23,744],function(){return e(e.s=82788)}),_N_E=e.O()}]);