(()=>{var e={};e.id=266,e.ids=[266],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4341:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>l}),s(4544),s(7160),s(5866);var r=s(3191),n=s(8716),i=s(7922),a=s.n(i),c=s(5231),o={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);s.d(t,o);let l=["",{children:["certificates",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4544)),"/Users/dennis_leedennis_lee/Documents/GitHub/Pennis-Biometric-Measurement---Certification-System/app/certificates/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,7160)),"/Users/dennis_leedennis_lee/Documents/GitHub/Pennis-Biometric-Measurement---Certification-System/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/dennis_leedennis_lee/Documents/GitHub/Pennis-Biometric-Measurement---Certification-System/app/certificates/page.tsx"],u="/certificates/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/certificates/page",pathname:"/certificates",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},3132:(e,t,s)=>{Promise.resolve().then(s.bind(s,1722))},1722:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(326),n=s(7577),i=s(434),a=s(4139),c=s(6824),o=s(4703);function l(){let{session:e,accessToken:t}=(0,a.a)(),[s,l]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[p,m]=(0,n.useState)(null),x=async e=>{if(t)try{let s=await (0,c.mv)(t,e);(0,o.cP)(s)}catch(e){m(e instanceof Error?e.message:"下載失敗")}};return r.jsx("main",{className:"min-h-screen bg-slate-50 px-4 py-12",children:(0,r.jsxs)("div",{className:"mx-auto max-w-2xl",children:[r.jsx("h1",{className:"mb-2 text-xl font-bold text-slate-900",children:"我的證書"}),r.jsx("p",{className:"mb-6 text-sm text-slate-600",children:"您已簽發的證書列表（多裝置同步）。"}),r.jsx(i.default,{href:"/",className:"mb-4 inline-block text-sm text-slate-600 hover:text-slate-900",children:"← 返回首頁"}),!e&&(0,r.jsxs)("div",{className:"rounded-lg bg-amber-50 p-4 text-amber-800",children:["請先 ",r.jsx(i.default,{href:"/login",className:"underline",children:"登入"})," 以查看證書。"]}),e&&(0,r.jsxs)(r.Fragment,{children:[d&&r.jsx("p",{className:"text-slate-500",children:"載入中…"}),p&&r.jsx("p",{className:"text-red-600",children:p}),!d&&!p&&0===s.length&&r.jsx("p",{className:"text-slate-500",children:"尚無證書。"}),!d&&s.length>0&&r.jsx("ul",{className:"space-y-3",children:s.map(e=>(0,r.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white p-4",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium",children:e.inquiryId}),(0,r.jsxs)("p",{className:"text-sm text-slate-500",children:[e.issuedAt," \xb7 ",e.lengthCm.toFixed(2)," cm"]})]}),r.jsx("button",{type:"button",onClick:()=>x(e.id),className:"rounded bg-slate-800 px-3 py-1.5 text-sm text-white hover:bg-slate-700",children:"下載"})]},e.id))})]})]})})}},6824:(e,t,s)=>{"use strict";s.d(t,{$F:()=>n,mv:()=>i,ys:()=>a});let r=process.env.NEXT_PUBLIC_API_URL||"http://localhost:8080";async function n(e,t,s){let n=await fetch(`${r}/api/certificates`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({inquiryId:t,measurement:s})});if(!n.ok)throw Error((await n.json().catch(()=>({}))).error||n.statusText);return n.json()}async function i(e,t){let s=await fetch(`${r}/api/certificates/${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)throw Error(s.statusText);return s.json()}async function a(e){let t=await fetch(`${r}/api/certificates/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(t.statusText);return t.json()}},4703:(e,t,s)=>{"use strict";function r(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`certification-${e.inquiryId}-${Date.now()}.json`,r.click(),URL.revokeObjectURL(s)}s.d(t,{cP:()=>r})},5442:(e,t,s)=>{"use strict";s.d(t,{S:()=>a});var r=s(5157);let n=process.env.NEXT_PUBLIC_SUPABASE_URL??"",i=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY??"";function a(){return n&&i?(0,r.eI)(n,i):(0,r.eI)("https://placeholder.supabase.co","placeholder")}},4139:(e,t,s)=>{"use strict";s.d(t,{a:()=>i});var r=s(7577),n=s(5442);function i(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(!0);return(0,n.S)(),{session:e,loading:s,accessToken:e?.access_token??null}}},4544:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>a,__esModule:()=>i,default:()=>c});var r=s(8570);let n=(0,r.createProxy)(String.raw`/Users/dennis_leedennis_lee/Documents/GitHub/Pennis-Biometric-Measurement---Certification-System/app/certificates/page.tsx`),{__esModule:i,$$typeof:a}=n;n.default;let c=(0,r.createProxy)(String.raw`/Users/dennis_leedennis_lee/Documents/GitHub/Pennis-Biometric-Measurement---Certification-System/app/certificates/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[819,434,157,990],()=>s(4341));module.exports=r})();